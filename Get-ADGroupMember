########## This Powershell script shows all members of an Active-Directory Group ###########
# Created on : August 23, 2019
# Last modification : August 24, 2019
# Script revision : 1.1


# Defining a mandatory parameter which asks for the Active-Directory Group.

Param(
    [Parameter(Mandatory=$true)]
    [string] $Group = $(Read-Host -prompt "Group : "),
    [string] $File = $(Read-Host -prompt "File (e.g. : C:\Path\of\the\file.txt) : ")
)


# Allowing the script to be executed and importing Active-Directory module in Powershell.

Set-ExecutionPolicy Unrestricted
Import-Module ActiveDirectory


# Getting current datetime (i.e. : 31/07/2019 - 12:08).

$Date = Get-Date -Format "dd/MM/yyyy - HH:mm"


# Creating an exception catcher to save exceptions into a log file and then end the script.

$Error = {
    $Exception = $_.Exception.GetType().fullname
    Write-Warning $_
    "$Date : Failed to show all members belonging to $Group : $_"|Add-Content C:\Users\$env:USERNAME\Documents\logs_2.txt
    exit(1)
}


# Checking if the file does already exists and if it is, clears it.

if ((Test-Path $File) -eq $true) {
    try {
        Clear-Content $File
    }
    catch {
        .$Error
    }
}

# Trying to show all members of the Active-Directory group. If an exception occurred, it is catched by the exception catcher written above.

try {
    Get-ADGroupMember -Identity $Group | select name, SamAccountName | sort-object -property name | Add-Content $File
    Get-Content $File
}
catch {
    .$Error
}

# End of the script if no exception has occurred.

exit(0)
